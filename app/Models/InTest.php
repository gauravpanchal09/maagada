<?php

/**
 * InTest
 * @author Ashish Bairagi <https://github.com/abbackend>
 */

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class InTest extends Model
{
    use HasFactory;

    /**
     * The attributes that are mass assignable.
     *
     * @var array
     */
    protected $fillable = [
        'patient_id',
        'p_married_year',
        'p_ttc',
        'p_ttc_year',
        'p_toi',
        'pc_method',
        'pc_duration_year',
        'mh_menarchat',
        'mh_year',
        'mh_previous_cycle',
        'mh_present_cycle',
        'mh_lmp',
        'oh_delivery',
        'oh_miscarriage',
        'oh_pgti',
        'oh_pa',
        'pmh_thyroid',
        'pmh_tuberculosis',
        'pmh_hypertension',
        'pmh_diabetes',
        'pmh_other',
        'sfh_wife',
        'sfh_husband',
        'eve_stature',
        'eve_pulse',
        'eve_height',
        'eve_weight',
        'eve_bp',
        'eve_bmi',
        'eve_anaemia',
        'eve_hyriod',
        'eve_hirsutism',
        'eve_face',
        'eve_breast',
        'eve_other',
        'eve_cvs',
        'eve_rs',
        'eve_sec_sex_character',
        'eve_breast2',
        'eve_public_hair',
        'eve_axillary_hairs',
        'ea_stature',
        'ep_ps',
        'ep_vulva',
        'ep_pv',
        'ep_veg',
        'tr_year',
        'husband_dob',
        'husband_occupation',
        'husband_married_previously',
        'husband_age',
        'husband_children',
        'husband_coitus_frequency',
        'husband_exection',
        'husband_ejaculation',
        'husband_orgasm',
        'husband_drugs',
        'husband_smoking',
        'husband_alcohol',
        'husband_pmh_mumps',
        'husband_pmh_kochs',
        'husband_pmh_diabetes',
        'husband_pmh_hypertension',
        'husband_pmh_previous_sergery',
        'husband_pmh_examination',
        'husband_pmh_stature',
        'husband_pmh_bp',
        'husband_pmh_sec_sex',
        'husband_pmh_genital_examination',
        'husband_semon_analysic',
        'husband_testicular_biospy',
        'husband_other_investigationq',
        'husband_te_advised',
        'husband_i_cbc',
        'husband_i_hb',
        'husband_i_td',
        'husband_i_esr',
        'husband_i_abo',
        'husband_i_hiv',
        'husband_i_blood_sugar',
        'husband_i_hbsag',
        'husband_i_urine',
        'husband_i_hcv',
        'husband_i_semen_culture',
        'husband_i_vdrl',
        'husband_i_sperm',
        'inv_hysteroscopy',
        'inv_laparoscopy',
        'inv_pcr_for_tb',
        'inv_hysterosalpingography',
        'wife_i_cbc',
        'wife_i_hb',
        'wife_i_td',
        'wife_i_esr',
        'wife_i_abo',
        'wife_i_hiv',
        'wife_i_blood_sugar',
        'wife_i_hbsag',
        'wife_i_urine',
        'wife_i_hcv',
        'wife_i_vdrl',
        'he_anh_date',
        'he_anh_day_of_cycle',
        'he_anh_result',
        'he_anh_normal_range',
        'he_prolaction_date',
        'he_prolaction_day_of_cycle',
        'he_prolaction_result',
        'he_prolaction_normal_range',
        'he_lh_date',
        'he_lh_day_of_cycle',
        'he_lh_result',
        'he_lh_normal_range',
        'he_fsh_date',
        'he_fsh_day_of_cycle',
        'he_fsh_result',
        'he_fsh_normal_range',
        'he_testosterone_date',
        'he_testosterone_day_of_cycle',
        'he_testosterone_result',
        'he_testosterone_normal_range',
        'he_oestrogen_date',
        'he_oestrogen_day_of_cycle',
        'he_oestrogen_result',
        'he_oestrogen_normal_range',
        'he_progesterone_date',
        'he_progesterone_day_of_cycle',
        'he_progesterone_result',
        'he_progesterone_normal_range',
        'he_dheas_date',
        'he_dheas_day_of_cycle',
        'he_dheas_result',
        'he_dheas_normal_range',
        'he_cortisol_date',
        'he_cortisol_day_of_cycle',
        'he_cortisol_result',
        'he_cortisol_normal_range',
        'he_t3_date',
        'he_t3_day_of_cycle',
        'he_t3_result',
        'he_t3_normal_range',
        'he_t4_date',
        'he_t4_day_of_cycle',
        'he_t4_result',
        'he_t4_normal_range',
        'he_tsh_date',
        'he_tsh_day_of_cycle',
        'he_tsh_result',
        'he_tsh_normal_range',
        'ivf_no2pn_1',
        'ivf_2pn_1',
        'ivf_discard_1',
        'icsi_no2pn_1',
        'icsi_2pn_1',
        'icsi_discard_1',
        'ivf_no2pn_2',
        'ivf_2pn_2',
        'ivf_discard_2',
        'icsi_no2pn_2',
        'icsi_2pn_2',
        'icsi_discard_2',
        'ivf_no2pn_3',
        'ivf_2pn_3',
        'ivf_discard_3',
        'icsi_no2pn_3',
        'icsi_2pn_3',
        'icsi_discard_3',
        'ivf_no2pn_4',
        'ivf_2pn_4',
        'ivf_discard_4',
        'icsi_no2pn_4',
        'icsi_2pn_4',
        'icsi_discard_4',
        'ivf_no2pn_5',
        'ivf_2pn_5',
        'ivf_discard_5',
        'icsi_no2pn_5',
        'icsi_2pn_5',
        'icsi_discard_5',
        'wife_hea_date',
        'wife_hea_toxoplasma_g',
        'wife_hea_toxoplasma_m',
        'wife_hea_rubella_g',
        'wife_hea_rubella_m',
        'wife_hea_cmv_g',
        'wife_hea_cmv_m',
        'wife_hea_herpes_g',
        'wife_hea_herpes_m',
        'wife_hea_aca_g',
        'wife_hea_aca_m',
        'wife_hea_apa_g',
        'wife_hea_apa_m',
        'wife_hea_ana_g',
        'wife_hea_ana_m',
        'wife_hea_la_g',
        'wife_hea_la_m',
        'sa_hrs_1',
        'wife_ici_day_1',
        'wife_ici_date_1',
        'wife_ici_endo_1',
        'wife_ici_rtov_1',
        'wife_ici_ltov_1',
        'wife_ici_remark_1',
        'wife_ici_day_2',
        'wife_ici_date_2',
        'wife_ici_endo_2',
        'wife_ici_rtov_2',
        'wife_ici_ltov_2',
        'wife_ici_remark_2',
        'wife_ici_day_3',
        'wife_ici_date_3',
        'wife_ici_endo_3',
        'wife_ici_rtov_3',
        'wife_ici_ltov_3',
        'wife_ici_remark_3',
        'wife_ici_day_4',
        'wife_ici_date_4',
        'wife_ici_endo_4',
        'wife_ici_rtov_4',
        'wife_ici_ltov_4',
        'wife_ici_remark_4',
        'wife_ici_day_5',
        'wife_ici_date_5',
        'wife_ici_endo_5',
        'wife_ici_rtov_5',
        'wife_ici_ltov_5',
        'wife_ici_remark_5',
        'wife_ici_day_6',
        'wife_ici_date_6',
        'wife_ici_endo_6',
        'wife_ici_rtov_6',
        'wife_ici_ltov_6',
        'wife_ici_remark_6',
        'wife_ici_day_7',
        'wife_ici_date_7',
        'wife_ici_endo_7',
        'wife_ici_rtov_7',
        'wife_ici_ltov_7',
        'wife_ici_remark_7',
        'wife_ici_day_8',
        'wife_ici_date_8',
        'wife_ici_endo_8',
        'wife_ici_rtov_8',
        'wife_ici_ltov_8',
        'wife_ici_remark_8',
        'wife_ici_day_9',
        'wife_ici_date_9',
        'wife_ici_endo_9',
        'wife_ici_rtov_9',
        'wife_ici_ltov_9',
        'wife_ici_remark_9',
        'wife_ici_day_10',
        'wife_ici_date_10',
        'wife_ici_endo_10',
        'wife_ici_rtov_10',
        'wife_ici_ltov_10',
        'wife_ici_remark_10',
        'wife_ici_extra_data',
        'wife_iuid_day_1',
        'wife_iuid_volume_1',
        'wife_iuid_native_couint_1',
        'wife_iuid_motility1_1',
        'wife_iuid_harvest_count_1',
        'wife_iuid_motility2_1',
        'wife_iuid_motility3_1',
        'wife_iuid_remark_1',
        'wife_iuid_day_2',
        'wife_iuid_volume_2',
        'wife_iuid_native_couint_2',
        'wife_iuid_motility1_2',
        'wife_iuid_harvest_count_2',
        'wife_iuid_motility2_2',
        'wife_iuid_motility3_2',
        'wife_iuid_remark_2',
        'wife_iuid_day_3',
        'wife_iuid_volume_3',
        'wife_iuid_native_couint_3',
        'wife_iuid_motility1_3',
        'wife_iuid_harvest_count_3',
        'wife_iuid_motility2_3',
        'wife_iuid_motility3_3',
        'wife_iuid_remark_3',
        'wife_iuid_day_4',
        'wife_iuid_volume_4',
        'wife_iuid_native_couint_4',
        'wife_iuid_motility1_4',
        'wife_iuid_harvest_count_4',
        'wife_iuid_motility2_4',
        'wife_iuid_motility3_4',
        'wife_iuid_remark_4',
        'wife_iuid_day_5',
        'wife_iuid_volume_5',
        'wife_iuid_native_couint_5',
        'wife_iuid_motility1_5',
        'wife_iuid_harvest_count_5',
        'wife_iuid_motility2_5',
        'wife_iuid_motility3_5',
        'wife_iuid_remark_5',
        'wife_iuid_day_6',
        'wife_iuid_volume_6',
        'wife_iuid_native_couint_6',
        'wife_iuid_motility1_6',
        'wife_iuid_harvest_count_6',
        'wife_iuid_motility2_6',
        'wife_iuid_motility3_6',
        'wife_iuid_remark_6',
        'result_description',
        'result_tton',
        'result_remarks',
        'result_by',
        'wife_lmp_oc_begin',
        'wife_lmp_oc_stopped',
        'wife_lmp_oc_tco',
        'wife_lmp_telephone_begin',
        'wife_lmp_telephone_stopped',
        'wife_lmp_telephone_tco',
        'wife_lmp_discussion_begin',
        'wife_lmp_discussion_stopped',
        'wife_lmp_discussion_tco',
        'wife_lmp_lupride',
        'wife_lmp_stared',
        'wife_lmp_tocome',
        'wife_lmp_protocol',
        'result_lmp',
        'result_stm_start',
        'result_date_1',
        'result_cyc_day_1',
        'result_stm_day_1',
        'result_end_1',
        'result_rafc_1',
        'result_lafc_1',
        'result_stimulation_1',
        'result_misc_1',
        'result_date_2',
        'result_cyc_day_2',
        'result_stm_day_2',
        'result_end_2',
        'result_rafc_2',
        'result_lafc_2',
        'result_stimulation_2',
        'result_misc_2',
        'result_date_3',
        'result_cyc_day_3',
        'result_stm_day_3',
        'result_end_3',
        'result_rafc_3',
        'result_lafc_3',
        'result_stimulation_3',
        'result_misc_3',
        'result_date_4',
        'result_cyc_day_4',
        'result_stm_day_4',
        'result_end_4',
        'result_rafc_4',
        'result_lafc_4',
        'result_stimulation_4',
        'result_misc_4',
        'result_date_5',
        'result_cyc_day_5',
        'result_stm_day_5',
        'result_end_5',
        'result_rafc_5',
        'result_lafc_5',
        'result_stimulation_5',
        'result_misc_5',
        'result_date_6',
        'result_cyc_day_6',
        'result_stm_day_6',
        'result_end_6',
        'result_rafc_6',
        'result_lafc_6',
        'result_stimulation_6',
        'result_misc_6',
        'result_date_7',
        'result_cyc_day_7',
        'result_stm_day_7',
        'result_end_7',
        'result_rafc_7',
        'result_lafc_7',
        'result_stimulation_7',
        'result_misc_7',
        'result_date_8',
        'result_cyc_day_8',
        'result_stm_day_8',
        'result_end_8',
        'result_rafc_8',
        'result_lafc_8',
        'result_stimulation_8',
        'result_misc_8',
        'result_date_9',
        'result_cyc_day_9',
        'result_stm_day_9',
        'result_end_9',
        'result_rafc_9',
        'result_lafc_9',
        'result_stimulation_9',
        'result_misc_9',
        'result_date_10',
        'result_cyc_day_10',
        'result_stm_day_10',
        'result_end_10',
        'result_rafc_10',
        'result_lafc_10',
        'result_stimulation_10',
        'result_misc_10',
        'result_date_11',
        'result_cyc_day_11',
        'result_stm_day_11',
        'result_end_11',
        'result_rafc_11',
        'result_lafc_11',
        'result_stimulation_11',
        'result_misc_11',
        'result_date_12',
        'result_cyc_day_12',
        'result_stm_day_12',
        'result_end_12',
        'result_rafc_12',
        'result_lafc_12',
        'result_stimulation_12',
        'result_misc_12',
        'result_date_13',
        'result_cyc_day_13',
        'result_stm_day_13',
        'result_end_13',
        'result_rafc_13',
        'result_lafc_13',
        'result_stimulation_13',
        'result_misc_13',
        'result_date_14',
        'result_cyc_day_14',
        'result_stm_day_14',
        'result_end_14',
        'result_rafc_14',
        'result_lafc_14',
        'result_stimulation_14',
        'result_misc_14',
        'result_date_15',
        'result_cyc_day_15',
        'result_stm_day_15',
        'result_end_15',
        'result_rafc_15',
        'result_lafc_15',
        'result_stimulation_15',
        'result_misc_15',
        'result_date_16',
        'result_cyc_day_16',
        'result_stm_day_16',
        'result_end_16',
        'result_rafc_16',
        'result_lafc_16',
        'result_stimulation_16',
        'result_misc_16',
        'wife_lmp_lh',
        'wife_lmp_e2',
        'wife_lmp_inj',
        'wife_lmp_dose',
        'wife_lmp_hcg',
        'wife_lmp_hcg_day',
        'wife_lmp_opu',
        'wife_lmp_ampm',
        'sperm_source_folliciles_right',
        'sperm_source_folliciles_left',
        'sperm_source_folliciles_total',
        'sperm_source_ovum_right',
        'sperm_source_ovum_left',
        'sperm_source_ovum_pod',
        'sperm_source_ovum_total',
        'oocyte_quality_1_no',
        'oocyte_quality_1_stage',
        'oocyte_quality_2_no',
        'oocyte_quality_2_stage',
        'oocyte_quality_3_no',
        'oocyte_quality_3_stage',
        'oocyte_quality_4_no',
        'oocyte_quality_4_stage',
        'oocyte_quality_5_no',
        'oocyte_quality_5_stage',
        'sperm_source_ejaculated',
        'sperm_source_donor',
        'sperm_source_pesa',
        'sperm_source_cryo',
        'sperm_source_test',
        'sperm_source_recovery',
        'sperm_source_whom',
        'sperm_source_when',
        'sa_volume_native',
        'sa_volume_ah',
        'sa_mucoid_native',
        'sa_mucoid_ah',
        'sa_sperm_count_native',
        'sa_sperm_count_ah',
        'sa_motility_native',
        'sa_motility_ah',
        'sa_grade_native',
        'sa_grade_ah',
        'sa_pus_cells_native',
        'sa_pus_cells_ah',
        'sa_immature_cells_native',
        'sa_immature_cells_ah',
        'sa_agglutination_native',
        'sa_agglutination_ah',
        'sa_granular_debris_native',
        'sa_granular_debris_ah',
        'sa_insemination_time_native',
        'sa_insemination_time_ah',
        'result_ivf',
        'result_icsi',
        'sa_no2pn_1',
        'sa_2pn_1',
        'sa_max2pn_1',
        'sa_no2pn_2',
        'sa_2pn_2',
        'sa_max2pn_2',
        'et_date_of_et',
        'et_time_of_et',
        'et_endometrium_t',
        'et_cathetar',
        'et_transfer_stage',
        'et_embryo_transfer',
        'bt_date_of_et',
        'bt_time_of_et',
        'bt_endometrium_t',
        'bt_cathetar',
        'bt_transfer_stage',
        'bt_embryo_transfer',
        'frozen_stage',
        'frozen_blastocyst',
        'frozen_embryo_datetime',
        'frozen_blastocyst_datetime',
        'frozen_straws',
        'frozen_mark',
        'frozen_plastic_colour',
        'frozen_ln2',
        'thawing_date_of_et',
        'thawing_time_of_et',
        'thawing_endometrium_t',
        'thawing_cathetar',
        'thawing_transfer_stage',
        'thawing_embryo_transfer',
        'treatment_plan',
        'result_eudate',
        'result_bhcg',
        'result_semen_cryo'
    ];

    protected $casts = [
        'inv_images' => 'array', 
        'wife_ici_extra_data' => 'array'
    ];

    public function patient()
    {
        return $this->belongsTo(Patient::class);
    }

    public function history()
    {
        return $this->hasMany(TestHistory::class, 'test_id', 'id');
    }

    public function setInvImages(array $images): self
    {
        $this->inv_images = array_values(array_unique($images));

        return $this;
    }

    public function getFileByIndex(int $index): string
    {
        return $this->inv_images[$index];
    }

    /*******************************************
    * Query Scopes
    *******************************************/
    public function scopeForPatient($query, $patient)
    {
        return $query->where('patient_id', ($patient instanceof Patient) ? $patient->id : $patient);
    }
}
